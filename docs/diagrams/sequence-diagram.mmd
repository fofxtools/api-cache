sequenceDiagram
    participant Client
    participant BaseApiClient
    participant ApiCacheHandler
    participant RateLimitService
    participant CacheRepository
    participant CompressionService
    participant ApiEndpoint
    
    Client->>+BaseApiClient: sendCachedRequest(endpoint, params, method)
    BaseApiClient->>+ApiCacheHandler: processRequest(this, endpoint, params, method)
    
    Note over ApiCacheHandler: generateCacheKey()
    
    ApiCacheHandler->>+CacheRepository: get(client, key)
    
    alt Cache Hit
        CacheRepository->>+CompressionService: decompress(data)
        CompressionService-->>-CacheRepository: decompressed data
        CacheRepository-->>ApiCacheHandler: cached response
        ApiCacheHandler-->>BaseApiClient: cached response
    else Cache Miss
        CacheRepository-->>ApiCacheHandler: not found
        ApiCacheHandler->>+RateLimitService: allowRequest(clientName)
        
        alt Rate Limited
            RateLimitService-->>ApiCacheHandler: false
            ApiCacheHandler-->>BaseApiClient: throw RateLimitException
        else Request Allowed
            RateLimitService-->>ApiCacheHandler: true
            
            ApiCacheHandler->>+BaseApiClient: sendRequest(endpoint, params)
            BaseApiClient->>ApiEndpoint: HTTP request
            ApiEndpoint-->>BaseApiClient: HTTP response
            BaseApiClient-->>ApiCacheHandler: API result
            
            ApiCacheHandler->>+RateLimitService: incrementAttempts(clientName)
            Note over RateLimitService: Track this request for rate limiting.
            RateLimitService-->>ApiCacheHandler: void
            
            ApiCacheHandler->>+CacheRepository: store(client, key, metadata)
            Note over CacheRepository: Save API response to the cache.
            CacheRepository->>+CompressionService: compress(data)
            CompressionService-->>-CacheRepository: compressed data
            CacheRepository-->>ApiCacheHandler: void
            
            ApiCacheHandler-->>BaseApiClient: API result
        end
    end
    BaseApiClient-->>-Client: return result 